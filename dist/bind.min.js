var Bind=function(b){"use strict";function j(a){return(a+"").replace(/[<>]/g,function(a){return{">":"&gt;","<":"&lt;"}[a]})}function k(a,b){for(var c=a.length,d=0;d<c;d++)b(a[d],d,a)}function l(a,b){k("pop push reverse shift sort splice unshift".split(" "),function(d){this[d]=function(){this.__dirty=!0;var f=n({},e[d].apply(this,arguments));return delete this.__dirty,a&&b.ready&&a(this),f}.bind(this)}.bind(this));var d=this.length;return Object.defineProperty(this,"length",{configurable:!1,enumerable:!0,set:function(a){if(this.__dirty)return void(d=a);var b=1*a;return d!==b&&(b>d?this.push.apply(this,new Array(b-d)):this.splice(b),d=b),a},get:function(){return d}}),this}function m(a,b,e,o){return o||(o=[]),e.ready&&b.__callback?a:(k(Object.getOwnPropertyNames(b),function(q){if("__callback"!==q){var t,r=b[q],s=[].slice.call(o),u=function(a){return j(a)},v=h;s.push(q);var w=e.mapping[s.join(".")];if(w&&"[object Object]"===w.toString()&&(w.callback&&(t=w.callback),w.transform&&(u=i(w.transform.bind({safe:j}))),w.parse&&(v=i(w.parse)),w=w.dom),"function"==typeof w)t=w;else if("string"==typeof w){var x=d(w||"☺");0===x.length&&console.warn('No elements found against "'+w+'" selector');var y=["SELECT","INPUT","PROGRESS","TEXTAREA"];null!==r&&void 0!==r||(r=v(-1!==y.indexOf(x[0].nodeName)?x[0].value:x[0].innerHTML));var z=t;t=function(b){x=d(w||"☺"),x&&k(x,function(a){if(!a.__dirty)if(-1!==y.indexOf(a.nodeName)){var c=u(b);if("checkbox"===a.type){if(b instanceof Array){var d=b.filter(function(b){if(b===a.value)return a.checked=a.value===b,!0});0===d.length&&(a.checked=!1)}}else if("radio"===a.type)a.checked=a.value===c;else if("number"==typeof a.value)try{a.value=1*c}catch(a){console.error(a.message)}else a.value=c}else{b instanceof Array||(b=[b]);var e="";k(b,function(a){e+=u(a)}),a.innerHTML=e}}),z&&z.apply(a,arguments)},k(x,function(b){if("INPUT"===b.nodeName||"SELECT"===b.nodeName||"TEXTAREA"===b.nodeName){var c=function(){this.__dirty=!0;var c;if("checkbox"===b.type){var d=(b.form||document).querySelectorAll('input[name="'+b.name+'"][type="'+b.type+'"]');if(a[q]instanceof Array){var e=[];k(d,function(a){a.checked&&e.push(v(a.value))}),c=e}else c=this.checked?v(this.value):null}else"radio"===b.type&&(c=this.checked?v(this.value):null),c=v("number"==typeof a[q]?1*this.value:this.value);void 0===c&&(c=this.value),a[q]=c,this.__dirty=!1},d={checkbox:"change",radio:"change","select-one":"change"}[b.type];b.addEventListener(d||"input",c)}})}t&&s.reduce(function(a,b,c,d){return a[b]||(a[b]={}),c===d.length-1&&(a[b].__callback=t),a[b]},e.callbacks);var A=function(b){var d=[],f=[],g=e.instance,h=!1,i=!1;if(c&&console.log("> finding callback for %s",q,s),s.reduce(function(a,c,e){if(a&&a[c]&&c){if(null===(g=g[c])||void 0===g)return a[c]||{};if("function"==typeof a[c].__callback){var j=e===s.length-1?b:g;g.__dirty&&(h=!0),e===s.length-1&&a[c].__callback&&(i={path:s.join("."),callback:a[c].__callback,instance:j}),h||(f.push(n(j instanceof Array?[]:{},j)),d.push(a[c].__callback))}return a[c]||{}}},e.callbacks),h||(f.reverse(),d.reverse().forEach(function(a,b){a.call(e.instance,f[b])})),h&&i){var g=i.instance;i.callback.call(e.instance,n(g instanceof Array?[]:{},g))}},B={configurable:!0,enumerable:!0,set:function(b){var d=r!==b?r:void 0;r=!e.ready||typeof b!==g||null===b||f(b)||b.__callback?f(b)?m(new l(A,e),b,e,s):b:m(a[q]?n({},a[q]):{},b,e,s),c&&console.log("set: key(%s): %s -> %s",q,JSON.stringify(d),JSON.stringify(b)),e.ready?A(r):e.deferred.push(A.bind(a,r,d))},get:function(){return r}};try{Object.defineProperty(a,q,B)}catch(a){}typeof r!==g||null===r||f(r)?f(r)?a[q]=m(new l(A,e),r,e,s):a instanceof l||(a[q]=r):a[q]=m(a[q]||{},r,e,s)}}),a instanceof l&&a.push.apply(a,b),a)}function n(b,c){return c instanceof Object?(k(Object.getOwnPropertyNames(c),function(d){var e=c[d];a.prototype[d]||"__callback"===d||(typeof e===g&&null!==e&&e instanceof Array?b[d]=[].map.call(e,function(a){return a instanceof Object?n(b[d]||{},a):a}):typeof e!==g||null===e||f(e)?b[d]=e:b[d]=n(b[d]||{},e))}),b):c}function a(c,d){if(!this||this===b)return new a(c,d);var e={mapping:d||{},callbacks:{},deferred:[],ready:!1,instance:this};return m(this,c,e),e.ready=!0,e.deferred.length&&k(e.deferred,function(b){b()}),this}if(!Function.bind||!Object.defineProperty)throw new Error("Prerequisite APIs not available.");var d,c=!1;try{d=document.querySelectorAll.bind(document)}catch(a){}var e=[],f=Array.isArray,g="object",h=function(a){return a},i=function(a){return function(){try{return a.apply(this,arguments)}catch(a){console.error(a.stack?a.stack:a)}}};return l.prototype=[],a.prototype.__export=function(){return n({},this)},a}(this);"undefined"!=typeof exports&&(module.exports=Bind);